# 编码结构

在本章和接下来的第 5 章中，将解释 HEVC 比特流和解码的 HEVC 视频序列的一般结构。图片类型和将编码图片划分为不同类型的单元和块指定了用于表示编码视频序列的空间和时间结构。虽然本章重点讨论图像之间的关系以及用于表示编码图像的空间结构，但第 5 章讨论了位流中编码数据的高级语法和组织。由于时空结构和编码表示之间的强相互关系，本章中仍然提到了比特流表示的一些方面。这里使用的术语包括 NAL（网络抽象层）单元、视频参数集(VPS)、序列参数集(SPS)和图片参数集(PPS)。第 5 章对此作了进一步的详细说明。

为了在比特流中以编码形式表示视频序列，可以使用灵活的时间编码结构，如第4.1节所述。这些编码结构描述了待编码图片的编码顺序，相对于图像最终被安排用于输出(例如到屏幕 1)的输出顺序。选择的编码结构影响编码视频序列的结构延迟，即，以输出顺序在图像之前但以编码顺序在图像之后的最大图像数。该数字也称为最大延迟增加，并在 VPS 和 SPS 中表示为编码视频序列的特征。

第 4.2 节详细介绍了将单个图像组织为单元和块的过程。图像被分割成一个或多个 slice，其中每个 slice 可以由一个或多个 slice segments 组成。slice segments 被组织成编码单元、预测单元和变换单元，他们一起包含 slice 样本块的编码表示。HEVC 中规定了三种不同的 slice 类型，允许仅帧内编码(I slice)、使用一个参考图像列表的帧内编码和预测编码(P slice)以及使用两个参考图像列表的帧内编码和预测编码(B  slice)。图像可以被分割成块，这些块改变了图像组成的块和单元的编码顺序。第 4.2.3 节讨论了 slice 和 tile 的相互作用。

## 4.1 时域编码结构

给定数量图像的视频可分为一个或多个编码视频序列(CVC，见第3.5.1.2节)。相同码流中的每个 CVS 都可以独立解码。在本节中，重点是单个编码视频序列以及编码视频序列中图片在编码顺序和输出顺序方面的组织。图片的输出顺序是生成图片的顺序，以及输出图片以供显示的顺序，以类似于预期视觉印象的原始输入序列的图片顺序。在 SPEC 中，输出顺序由图片顺序技术(POC)表示，其唯一地标识编码视频序列内的图片。注意，在整个 CVS 中，两个连续图片之间的 POC 距离不需要恒定。只需沿着输出顺序严格增加，更全面的讨论见第 5.4.1 节。

编码顺序指定在解码器处重建图片的顺序，并由此定义哪些图片可用于参考。显然，只有先前解码的图片才能被参考，进行预测。图片之间的相关性决定了编码视频序列的编码结构。编码结构包括序列中具有特定编码顺序的连续图片集，定义了包含的图片之间的依赖关系。完整的视频序列可以由该编码结构的周期性重复来表示。编码结构中包含的图片集通常成为图片组(GOP)。在 HEVC 规范的上下文中，此集合称为图片结构(SOP,Structure of Picture)。在本文中，我们将使用先前确定的术语 GOP。

有时，按照编码顺序的 GOP 的第一个图片被称为 GOP 的锚图片或关键图片。请注意，本规范中未使用这些术语以及术语组图片。然而，他们在文献中通常用于描述此类编码结构。

在图 4.1 中，提供了具有不同编码顺序和输出顺序的两个示例编码结构。两种编码结构的 GOP 大小为 8 涨图片，GOP 的关键图片用深灰色标记。图 4.1a 显示了一种编码结构，其中 GOP 的所有图片都是根据过去的编码图片进行预测的(从预测参考到预测目标的所有箭头都指向未来图片)。由于在输出顺序中没有从任何编码图片到未来图片的依赖性，因此图片的编码顺序实际上对应于输出顺序，即图片的显示顺序。在给定的示例中，每个图片的编码顺序实际上对应于输出顺序，即图片的显示顺序。在给定的示例中，每个图片使用单个参考图片进行预测。来自单个参考的预测称为单预测。历史上，这样的图片被称为 P 图片。编码结构进一步展示图片的特定层次。例如，具有奇数输出号码的图片可以在不影响其他图片的可解码性的情况下被丢弃。其他图片的编码结构独立于这些图片。类似地，每四幅图片可以在不受中间图片影响的情况下解码，中间图片的输出数为偶数。这种结构称为分层编码结构。在仅使用P图片的给定示例中，编码结构被称为分层P结构。应当注意，单预测当然可以指包括用于预测的多个参考图片的参考图片列表。但是，对于每个块，只能使用一个参考图片。

图 4.1b 提供了一个编码结构示例，其中包括来自过去图片和未来图片的预测箭头。对于这种编码结构，编码顺序不同于输出顺序，即一些图片需要存储，直到它们被输出。这导致了前面描述的结构延迟。具有来自过去和未来的参考的编码结构通常与双预测一起使用，其中对图片的预测由两个参考的组合形成。这些图片被称为 B 图片。与 P 图片示例一样，所提出的结构展示了预测层次结构，其中预测相关性被嵌套，使得可以丢弃某些图片而不影响其他图片的可解码性。这种结构称为“分层 B 编码结构”。图 4.2 按编码顺序显示了图 4.1b 的编码结构。

编码结构的连续 GOP 之间可能存在预测关系。这种预测相关性的一个例子如图 4.1b 所示。这种结构称为开放式 GOP 编码结构：一个 GOP 的图片来自不同 GOP 的参考图片。省略连续 GOP 之间相互依赖的结构称为闭合 GOP 编码结构。图 4.3 给出了这种编码结构的示例。这里所示的结构包括 I 图片(仅帧内编码)、P 图片和 B 图片，并且类似地用于 H.262|MPEG-2或 MPEG-4 视频中的编码。

HEVC SPEC 包括SEI消息（补充增强信息，请参阅第5.5 节）。编码器可用于描述所用GOP结构的“图片结构”，包括相应的图片类型、适用的参考图片集以及GOP中图片之间的时间关系。


